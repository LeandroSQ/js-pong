(()=>{var $=Math.pow;var p=(s,t,e)=>new Promise((i,n)=>{var o=g=>{try{l(e.next(g))}catch(m){n(m)}},u=g=>{try{l(e.throw(g))}catch(m){n(m)}},l=g=>g.done?i(g.value):Promise.resolve(g.value).then(o,u);l((e=e.apply(s,t)).next())});window.addLoadEventListener=function(s){let t=!1,e=()=>{t||(t=!0,s())};window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e),document.addEventListener("load",e),window.addEventListener("ready",e),setTimeout(e,1e3)};window.addVisibilityChangeEventListener=function(s){let t=["webkit","moz","ms",""],e=!1,i=()=>{if(e)return;e=!0;let n=t.map(o=>o&&o.length>0?`${o}Hidden`:"hidden").map(o=>document[o]).reduce((o,u)=>o||u,!1);setTimeout(()=>{s(!n),e=!1},0)};for(let n of t)document.addEventListener(`${n}visibilitychange`,i);document.onvisibilitychange=i};HTMLCanvasElement.prototype.screenshot=function(s="download.png"){let t=document.createElement("a");t.download=s,t.href=this.toDataURL("image/png;base64"),t.style.visibility="hidden",t.style.display="none",document.body.appendChild(t),setTimeout(()=>{t.click(),document.body.removeChild(t)},100)};String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,s=>s[1].toUpperCase()).trim()};Array.prototype.remove=function(s){let t=this.indexOf(s);return t!=-1?(this.splice(t,1),!0):!1};Array.prototype.appendArray=function(s){if(!!s)for(let t=0;t<s.length;t++)this.push(s[t])};Math.clamp=function(s,t,e){return Math.min(Math.max(s,t),e)};Math.average=function(...s){return s.reduce((t,e)=>t+e,0)/s.length};Math.distance=function(s,t,e,i){return Math.sqrt(Math.pow(e-s,2)+Math.pow(i-t,2))};Math.randomInt=function(s,t){return Math.floor(Math.random()*(t-s+1))+s};Math.lerp=function(s,t,e){return s+(t-s)*e};Math.oscilate=function(s,t,e,i){let n=2*Math.PI*t,o=i-e,l=(Math.sin(n*s)+1)/2;return e+l*o};CanvasRenderingContext2D.prototype.clear=function(){this.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasRenderingContext2D.prototype.line=function(s,t,e,i){this.beginPath(),this.moveTo(s,t),this.lineTo(e,i),this.stroke()};CanvasRenderingContext2D.prototype.fillTextCentered=function(s,t,e){let i=this.measureText(s);this.fillText(s,t-i.width/2,e)};Promise.delay=function(s){return new Promise((t,e)=>{setTimeout(t,s)})};var b=class{static logColoredText(t,e,i,...n){console[t].call(console,`%c${t.toUpperCase()} %c[${e}]`,`font-weight: bold; color: ${i};`,"font-weight: bold; color: gray",...n)}static info(t,...e){this.logColoredText("info",t,"turquoise",...e)}static warn(t,...e){this.logColoredText("warn",t,"yellow",...e)}static error(t,...e){this.logColoredText("error",t,"red",...e)}static debug(t,...e){}};var r=class{constructor(t,e=void 0){this.x=t,e===void 0?this.y=t:this.y=e}dot(t){return this.x*t.x+this.y*t.y}add(t){return new r(this.x+t.x,this.y+t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}multiply(t){return new r(this.x*t,this.y*t)}divide(t){return new r(this.x/t,this.y/t)}normalize(){let t=this.length;return new r(this.x/t,this.y/t)}clone(){return new r(this.x,this.y)}static distance(t,e){return Math.sqrt($(t.x-e.x,2)+$(t.y-e.y,2))}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static get zero(){return new r(0,0)}toString(){return`{ ${this.x}, ${this.y} }`}};var f=class{constructor(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n}translate(t){return new f(this.x+t.x,this.y+t.y,this.width,this.height)}contains(t,e=void 0){if(t instanceof r&&e===void 0)return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y;if(t instanceof f&&e===void 0)return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height;if(typeof t=="number"&&typeof e=="number")return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height;throw new Error("Invalid arguments")}intersects(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}intersection(t){let e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width)-e,o=Math.min(this.y+this.height,t.y+t.height)-i;return new f(e,i,n,o)}get size(){return new r(this.width,this.height)}get position(){return new r(this.x,this.y)}set position(t){this.x=t.x,this.y=t.y}get center(){return new r(this.x+this.width/2,this.y+this.height/2)}clone(){return new f(this.x,this.y,this.width,this.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}toString(){return`{ x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height} }`}};var k=class{constructor(t=void 0){this.element=document.createElement("canvas");this.virtualWidth=0;this.virtualHeight=0;this.drawRatio=1;this.overrideRatio=void 0;t&&(this.element.id=t);let e=this.element.getContext("2d");if(!e)throw new Error("Could not get context of canvas");this.context=e,this.context.imageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.element.oncontextmenu=()=>!1}get backingStoreRatio(){return this.overrideRatio||this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1}get devicePixelRation(){return this.overrideRatio||window.devicePixelRatio||1}getDrawRatio(t,e){return e/t}setSize(t,e){this.drawRatio=this.getDrawRatio(this.backingStoreRatio,this.devicePixelRation),this.backingStoreRatio!==this.devicePixelRation?(this.element.width=t*this.drawRatio,this.element.height=e*this.drawRatio,this.element.style.width=`${t}px`,this.element.style.minWidth=`${t}px`,this.element.style.height=`${e}px`,this.element.style.minHeight=`${e}px`):(this.element.width=t,this.element.height=e,this.element.style.width="",this.element.style.height=""),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=t,this.virtualHeight=e}clear(){this.context.clearRect(0,0,this.element.width,this.element.height)}drawTo(t,e,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.element,t,e),i.restore()}attachToElement(t){t.appendChild(this.element)}get width(){return this.virtualWidth||this.element.width}get height(){return this.virtualHeight||this.element.height}get bounds(){return new f(0,0,this.width,this.height)}};var c=class{static isKeyDown(...t){return t.some(e=>this.keys[e])}static isKeyJustPressed(...t){return t.some(e=>this.keysJustPressed[e])}static onKeyDown(t){this.keys[t.key]=!0,this.keysJustPressed[t.key]=!0,this.isDirty=!0}static onKeyUp(t){this.keys[t.key]=!1,delete this.keysJustPressed[t.key],this.isDirty=!0}static isMouseButtonDown(...t){return t.some(e=>this.mouseButtons[e])}static isMouseButtonJustPressed(...t){return t.some(e=>this.mouseButtonsJustPressed[e])}static isMouseButtonJustReleased(...t){return t.some(e=>this.mouseButtonsJustReleased[e])}static onMouseMove(t){var e,i,n,o;this.mouseDelta.x=t.movementX,this.mouseDelta.y=t.movementY,this.mouse.x=t.clientX-((i=(e=t.target)==null?void 0:e.offsetLeft)!=null?i:0),this.mouse.y=t.clientY-((o=(n=t.target)==null?void 0:n.offsetTop)!=null?o:0),this.isDirty=!0}static onMouseDown(t){this.mouseButtons[t.button]=!0,this.mouseButtonsJustPressed[t.button]=!0,this.isDirty=!0}static onMouseUp(t){this.mouseButtons[t.button]=!1,this.mouseButtonsJustReleased[t.button]=!0,this.isDirty=!0}static onPointerDown(t,e){console.log("Pointer down",e),this.mouseButtons[e.button]=!0,this.mouseButtonsJustPressed[e.button]=!0,t.setPointerCapture(e.pointerId),this.isDirty=!0}static onPointerUp(t,e){console.log("Pointer up",e),this.mouseButtons[e.button]=!1,this.mouseButtonsJustReleased[e.button]=!0,t.releasePointerCapture(e.pointerId),this.isDirty=!0}static setup(t){window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),this.mouse.x=window.innerWidth/2,this.mouse.y=window.innerHeight/2,t.canvas.element.addEventListener("click",this.onMouseMove.bind(this)),t.canvas.element.addEventListener("mousemove",this.onMouseMove.bind(this)),t.canvas.element.addEventListener("mousedown",this.onMouseDown.bind(this)),t.canvas.element.addEventListener("mouseup",this.onMouseUp.bind(this)),t.canvas.element.addEventListener("pointermove",this.onMouseMove.bind(this)),t.canvas.element.addEventListener("pointerdown",this.onPointerDown.bind(this,t.canvas.element)),t.canvas.element.addEventListener("pointerup",this.onPointerUp.bind(this,t.canvas.element))}static update(){this.keysJustPressed={},this.mouseButtonsJustPressed={},this.mouseButtonsJustReleased={},this.isDirty=!1}};c.isDirty=!1,c.keys={},c.keysJustPressed={},c.mouse=r.zero,c.mouseDelta=r.zero,c.mouseButtons={},c.mouseButtonsJustPressed={},c.mouseButtonsJustReleased={};var v=class{static alpha(t,e){let i=t;i.startsWith("#")&&(i=i.slice(1)),i.length===3&&(i=i.replace(/./g,"$&$&"));let n=Math.round(e*255).toString(16).padStart(2,"0");return`#${i}${n}`}static interpolate(t,e,i){let n=`0x${t.trim().slice(1)}`,o=`0x${e.trim().slice(1)}`;n.length<5&&(n=n.replace(/./g,"$&$&")),o.length<5&&(o=o.replace(/./g,"$&$&"));let u=parseInt(n,16),l=parseInt(o,16),g=u>>16,m=u>>8&255,P=u&255,B=l>>16,it=l>>8&255,st=l&255,nt=Math.round(g+(B-g)*i),ot=Math.round(m+(it-m)*i),rt=Math.round(P+(st-P)*i);return`#${(16777216+(nt<<16)+(ot<<8)+rt).toString(16).slice(1)}`}static isColorLight(t){let e=`0x${t.trim().slice(1)}`;e.length<5&&(e=e.replace(/./g,"$&$&"));let i=parseInt(e,16),n=i>>16,o=i>>8&255,u=i&255;return Math.sqrt(.299*(n*n)+.587*(o*o)+.114*(u*u))>127.5}};var G=class{constructor(t,e){this.rect=t;this.color=e}render(t){t.strokeStyle=this.color,t.lineWidth=1,t.strokeRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},O=class{constructor(t,e){this.rect=t;this.color=e}render(t){t.fillStyle=this.color,t.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)}},z=class{constructor(t,e,i,n){this.start=t;this.end=e;this.color=i;this.thickness=n}render(t){t.strokeStyle=this.color,t.lineWidth=this.thickness,t.beginPath(),t.moveTo(this.start.x,this.start.y),t.lineTo(this.end.x,this.end.y),t.stroke()}},W=class{constructor(t,e,i){this.center=t;this.radius=e;this.color=i}render(t){t.fillStyle=this.color,t.lineWidth=1,t.beginPath(),t.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),t.fill()}},q=class{constructor(t,e,i,n){this.text=t;this.position=e;this.color=i;this.alignment=n}render(t){t.fillStyle=this.color,t.font="12px Arial",t.textAlign=this.alignment,t.fillText(this.text,this.position.x,this.position.y)}},J=class{constructor(t,e,i){this.origin=t;this.vector=e;this.color=i;this.ARROWHEAD_LENGTH=10;this.ARROWHEAD_ANGLE=Math.PI/6;this.MIN_LENGTH=1;this.MAX_LENGTH=100}render(t){let e=this.vector.length;if(e<this.MIN_LENGTH)return;e>this.MAX_LENGTH&&(this.vector=this.vector.normalize().multiply(this.MAX_LENGTH),e=this.MAX_LENGTH);let i=(e-this.MIN_LENGTH)/(this.MAX_LENGTH-this.MIN_LENGTH),n=v.alpha(this.color,i);t.fillStyle=n,t.strokeStyle=n,t.lineWidth=1.5,t.lineCap="round",t.beginPath(),t.moveTo(this.origin.x,this.origin.y),t.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.stroke();let o=10,u=Math.PI/6,l=Math.atan2(this.vector.y,this.vector.x);t.beginPath(),t.moveTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.lineTo(this.origin.x+this.vector.x-o*Math.cos(l-u),this.origin.y+this.vector.y-o*Math.sin(l-u)),t.lineTo(this.origin.x+this.vector.x-o*Math.cos(l+u),this.origin.y+this.vector.y-o*Math.sin(l+u)),t.lineTo(this.origin.x+this.vector.x,this.origin.y+this.vector.y),t.fill()}},w=class{static render(t){}static clear(){}static rect(t,e="#fff"){}static outline(t,e="#fff"){}static line(t,e,i="#fff",n=1){}static circle(t,e,i="#fff"){}static text(t,e,i="#fff",n="left"){}static arrow(t,e,i="#fff"){}},x=w;x.list=[];var C=class{static set(t){this.current=t}static apply(){document.body.style.cursor=this.current}static reset(){this.current="default"}};C.current="default";var a=class{static get isDark(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static setup(){return p(this,null,function*(){a.loadVariables(),a.observeChanges()})}static loadVariables(){let t=["--background","--foreground","--secondary","--container-background","--container-border","--container-shadow"];b.info("Theme",`Setting up theme, loading ${t.length} variables...`),console.groupCollapsed("Loading theme variables");let e=getComputedStyle(document.body);for(let i of t){let n=e.getPropertyValue(i),o=i.toString().toCamelCase();a[o]=n,console.log(`%c${o}`,`color: ${v.isColorLight(n)?"#212121":"#eee"}; background-color: ${n}`)}console.groupEnd()}static observeChanges(){let t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener("change",()=>{b.info("Theme",`Changed theme to ${t.matches?"dark":"light"}`),a.loadVariables()})}};var M="'Pixelify Sans', sans-serif",Y=74.80000000000001,I=10*3,U=440,Q=75,j=.2,Z=220,tt=110;var E=class{static setup(){return p(this,null,function*(){this.context=new AudioContext,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.gainNode.gain.setValueAtTime(j,this.context.currentTime)})}static play(t,e){this.isPlaying&&this.oscillator.stop(),this.oscillator=this.context.createOscillator(),this.oscillator.connect(this.gainNode),this.oscillator.type="sine",this.oscillator.frequency.setValueAtTime(t,this.context.currentTime),this.oscillator.start(),this.oscillator.stop(this.context.currentTime+e/1e3),this.isPlaying=!0}};E.isPlaying=!1;var D={DIFFICULTY:1};var R=class{constructor(t){this.bounds=new f(0,0,10*2,10*2);this.velocity=new r(0,0);this.timer=3;this.lastTimer=0;this.bounds.position=t,this.velocity=new r(0,0)}reset(t){this.timer=3,this.bounds.x=t.width/2-this.bounds.width/2,this.bounds.y=t.height/2-this.bounds.height/2}bounceOffPaddles(t,e){for(let i of t)this.bounds.intersects(i.bounds)&&(i.bounds.x<e.width/2?this.velocity.x<0:this.velocity.x>0)&&(this.velocity.x*=-1,this.playSound(U),D.DIFFICULTY*=1.01)}playSound(t){E.play(t,Q*(1+Math.random()*.8-.4))}bounceOffWalls(t,e){this.bounds.x<0&&this.velocity.x<0?(this.bounds.x=0,this.velocity.x*=-1,this.playSound(Z),D.DIFFICULTY=1,t[1].score++,this.reset(e)):this.bounds.x+this.bounds.width>e.width&&this.velocity.x>0&&(this.bounds.x=e.width-this.bounds.width,this.velocity.x*=-1,this.playSound(Z),t[0].score++,this.reset(e),D.DIFFICULTY=1),this.bounds.y<0&&this.velocity.y<0?(this.bounds.y=0,this.velocity.y*=-1,this.playSound(U)):this.bounds.y+this.bounds.height>e.height&&this.velocity.y>0&&(this.bounds.y=e.height-this.bounds.height,this.velocity.y*=-1,this.playSound(U))}updateTimer(t){this.timer-=t,this.timer<=0&&(this.velocity=new r(Math.random()<.5?-825:825,Math.random()<.5?-825:825)),Math.floor(this.timer)!==this.lastTimer&&(this.lastTimer=Math.floor(this.timer),this.playSound(tt*(3-this.timer+1)))}update(t,e,i){if(this.timer>0){this.updateTimer(t);return}this.bounds.x+=this.velocity.x*D.DIFFICULTY*t,this.bounds.y+=this.velocity.y*D.DIFFICULTY*t,this.bounceOffWalls(i,e),this.bounceOffPaddles(i,e)}render(t){this.timer>0?t.fillStyle=v.alpha(a.foreground,Math.sin(this.timer*(Math.PI*2)*1.2)*.25+.75):t.fillStyle=a.foreground,t.fillRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)}};var S=class{constructor(t){this.bounds=new f(0,0,20,100);this.score=0;this.bounds.position=t}update(t,e){}render(t){t.fillStyle=a.foreground,t.fillRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)}};var T=class extends S{constructor(e,i){super(e);this.ball=i}moveToCenter(e,i){let n=i.height/2-this.bounds.height/2;this.bounds.y=Math.lerp(this.bounds.y,n,e*1.5*D.DIFFICULTY)}update(e,i){if(this.ball.timer>0){this.moveToCenter(e,i);return}let n=this.ball.velocity.multiply(D.DIFFICULTY);if(this.bounds.x<i.width/2?n.x>0:n.x<0)this.moveToCenter(e,i);else{let l=this.ball.bounds.x+this.ball.bounds.width,g=(this.bounds.x-l)/n.x,m=this.ball.bounds.y+n.y*g;for(let B=0;(m<0||m+this.ball.bounds.height>i.height)&&B<10;B++)m<0&&(x.circle(new r(l-10,10),10,"rgba(255, 0, 0, 0.25)"),m=-m),m+this.ball.bounds.height>i.height&&(x.circle(new r(l-10,i.height-this.ball.bounds.height),10,"rgba(255, 0, 0, 0.25)"),m=i.height-this.ball.bounds.height-(m-i.height+this.ball.bounds.height));x.circle(new r(l-10,m-10),10,"red");let P=m-this.bounds.height/2;this.bounds.y=Math.lerp(this.bounds.y,P,e*1.5*D.DIFFICULTY)}this.bounds.y<10?this.bounds.y=10:this.bounds.y+this.bounds.height+10>i.height&&(this.bounds.y=i.height-this.bounds.height-10)}};var _=class extends S{constructor(e){super(e);this.enableMouse=!0}update(e,i){this.enableMouse?(this.bounds.y+=c.mouse.y-this.bounds.height/2-this.bounds.y,this.bounds.y<0?this.bounds.y=0:this.bounds.y+this.bounds.height>i.height&&(this.bounds.y=i.height-this.bounds.height)):(c.isKeyDown("ArrowUp")&&(this.bounds.y-=this.speed*e,this.bounds.y<0&&(this.bounds.y=0)),c.isKeyDown("ArrowDown")&&(this.bounds.y+=this.speed*e,this.bounds.y+this.bounds.height>i.height&&(this.bounds.y=i.height-this.bounds.height)))}};var V=class{constructor(t){this.main=t}get width(){return this.main.canvas.width}get height(){return this.main.canvas.height}invalidate(){this.main.invalidate()}requestLayout(){this.paddleA&&(this.paddleA.bounds.x=10),this.paddleB&&(this.paddleB.bounds.x=this.main.canvas.width-10-20),this.invalidate()}setup(){return p(this,null,function*(){b.debug("StatePlay","Setting up..."),this.ball=new R(new r(this.main.canvas.width/2-10,this.main.canvas.height/2-10)),this.paddleA=new _({x:10,y:this.main.canvas.height/2-100/2}),this.paddleB=new T({x:this.main.canvas.width-10-20,y:this.main.canvas.height/2-100/2},this.ball)})}update(t){return p(this,null,function*(){this.ball.update(t,this.main.canvas,[this.paddleA,this.paddleB]),this.paddleA.update(t,this.main.canvas),this.paddleB.update(t,this.main.canvas),this.invalidate()})}resize(){b.debug("StatePlay","Resizing..."),this.requestLayout()}render(t){this.main.canvas.clear(),this.main.renderBoard(),(this.paddleA.score>0||this.paddleB.score>0)&&(t.fillStyle=a.foreground,t.font=`${48}pt ${M}`,t.fillTextCentered(this.paddleA.score.toString(),this.main.canvas.width/4,48+10),t.fillTextCentered(this.paddleB.score.toString(),this.main.canvas.width*3/4,48+10)),this.ball.timer>0&&(t.fillStyle=a.foreground,t.font=`${48}pt ${M}`,t.fillTextCentered(Math.ceil(this.ball.timer).toString(),this.main.canvas.width/2,48+10)),this.paddleA.render(t),this.paddleB.render(t),this.ball.render(t)}};var F=class{constructor(t){this.main=t}setup(){return p(this,null,function*(){this.ball=new R(new r(this.main.canvas.width/2-10,this.main.canvas.height/2-10)),this.paddleA=new T({x:10,y:this.main.canvas.height/2-100/2},this.ball),this.paddleB=new T({x:this.main.canvas.width-10-20,y:this.main.canvas.height/2-100/2},this.ball)})}update(t){return p(this,null,function*(){this.main.invalidate(),this.ball.update(t,this.main.canvas,[this.paddleA,this.paddleB]),this.paddleA.update(t,this.main.canvas),this.paddleB.update(t,this.main.canvas),c.isMouseButtonDown(0)&&this.main.setState(new V(this.main))})}resize(){this.paddleA&&(this.paddleA.bounds.x=10),this.paddleB&&(this.paddleB.bounds.x=this.main.canvas.width-10-20)}render(t){this.main.canvas.clear(),t.save(),t.globalAlpha=a.isDark?.15:.25,t.filter="blur(2.5px)",this.main.renderBoard(),this.paddleA.render(t),this.paddleB.render(t),this.ball.render(t),t.restore(),t.save(),t.font=`${48}pt ${M}`,t.fillStyle=a.foreground,t.shadowColor=a.containerShadow,t.shadowBlur=10,t.shadowOffsetY=2.5,t.fillTextCentered("PONG",this.main.canvas.width/2,this.main.canvas.height/2-48),t.font=`${48/2}pt ${M}`,t.fillStyle=v.alpha(a.foreground,Math.oscilate(Date.now()/1e3,.5,.25,1)),t.fillTextCentered("Click to start",this.main.canvas.width/2,this.main.canvas.height/2),t.restore()}};var H=class{static setup(){return p(this,null,function*(){let t=`${48}pt ${M}`;document.fonts.check(t)||(yield document.fonts.load(t))})}};var K=class{constructor(){this.canvas=new k("canvas");this.ctx=this.canvas.context;this.isDirty=!0;this.handleAnimationFrameRequest=-1;this.lastFrameTime=performance.now();this.state=new F(this);this.globalTimer=0;b.info("Main","Starting up..."),this.attachHooks()}attachHooks(){b.info("Main","Attaching hooks..."),window.addLoadEventListener(this.onLoad.bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),c.setup(this)}onLoad(){return p(this,null,function*(){b.debug("Main","Window loaded"),this.canvas.attachToElement(document.body),this.onResize(),yield a.setup(),yield E.setup(),yield H.setup(),yield this.state.setup(),this.requestNextFrame()})}onVisibilityChange(t){b.info("Main",`Window visibility changed to ${t?"visible":"hidden"}`),t?(this.invalidate(),this.requestNextFrame()):this.handleAnimationFrameRequest!=-1&&cancelAnimationFrame(this.handleAnimationFrameRequest)}onResize(){b.debug("Main","Window resized");let t=16/10,e=1200,i=e/t,n=window.innerWidth-10*4,o=window.innerHeight-10*4;o>i&&(o=i),n>e&&(n=e),n/o>t?n=o*t:o=n/t,this.canvas.setSize(n,o),this.state.resize()}setState(t){this.state=t,this.state.setup(),this.state.resize(),this.invalidate()}invalidate(){this.isDirty=!0}requestNextFrame(){this.handleAnimationFrameRequest=requestAnimationFrame(this.loop.bind(this))}loop(t){return p(this,null,function*(){let e=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t,C.reset(),yield this.state.update(e),c.update(),C.apply(),this.isDirty&&(this.state.render(this.ctx),this.isDirty=!1),x.render(this.ctx),x.clear(),this.requestNextFrame()})}renderBoard(){this.ctx.beginPath(),this.ctx.strokeStyle=a.secondary,this.ctx.setLineDash([10,10*2]),this.ctx.lineWidth=10,this.ctx.moveTo(this.canvas.width/2,Y),this.ctx.lineTo(this.canvas.width/2,this.canvas.height/2-10*4),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,this.canvas.height/2+10*6),this.ctx.lineTo(this.canvas.width/2,this.canvas.height-Y),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.beginPath(),this.ctx.rect(this.canvas.width/2-I,this.canvas.height/2-I,I*2,I*2),this.ctx.stroke()}};window._instance=new K;})();
